# Система финансовой отчетности

Веб-сервис для ведения финансовой отчетности бизнеса, аналогичный Google Sheets документу.

## Технологии

- **Backend**: FastAPI, SQLAlchemy, PostgreSQL, JWT, pandas (для Excel/CSV)
- **Frontend**: React, TypeScript, Vite, Recharts (для графиков)

## Установка и запуск

### Backend

1. Установите зависимости:
```bash
cd backend
pip install -r requirements.txt
```

2. Создайте файл `.env` в папке `backend`:
```
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/fin_a
SECRET_KEY=your-secret-key-change-in-production
```

3. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE fin_a;
```

4. Запустите сервер:
```bash
uvicorn app.main:app --reload --port 8000
```

### Frontend

1. Установите зависимости:
```bash
cd frontend
npm install
```

2. Запустите dev-сервер:
```bash
npm run dev
```

Приложение будет доступно по адресу http://localhost:3000

## Реализованный функционал

### 1. Авторизация и безопасность
- ✅ Регистрация пользователей
- ✅ Вход в систему (JWT токены)
- ✅ Защита всех API endpoints
- ✅ Управление сессиями

### 2. Справочники
- ✅ Управление статьями доходов (CRUD)
- ✅ Управление статьями расходов (CRUD)
- ✅ Управление местами оплаты (CRUD)
- ✅ Активация/деактивация записей

### 3. ВВОД 1 - Движение денег
- ✅ Ввод поступлений и оплат
- ✅ Привязка к статьям доходов/расходов
- ✅ Привязка к местам оплаты
- ✅ Разделение бизнес/личные деньги
- ✅ Валидация данных (обязательные поля: дата, статья, место оплаты)
- ✅ Фильтрация по датам и типам
- ✅ Импорт/экспорт Excel/CSV

### 4. ВВОД 2 - Активы и обязательства
- ✅ Управление активами (оборотные, основные средства, нематериальные)
- ✅ Управление обязательствами (краткосрочные, долгосрочные)
- ✅ Фильтрация по датам и категориям
- ✅ CRUD операции

### 5. БАЛАНС - Автоматический расчет
**Реализованные расчеты:**
- ✅ Суммирование активов по категориям
- ✅ Суммирование обязательств по категориям
- ✅ Расчет капитала (активы - обязательства)
- ✅ Расчет денежных средств (доходы - расходы)
- ✅ Расчет на произвольную дату

**Отображение:**
- Таблица активов с итогами
- Таблица пассивов с итогами
- Денежные средства

### 6. ОДДС - Отчет о движении денежных средств
**Реализованные расчеты:**
- ✅ Группировка по периодам (месяц/квартал/год)
- ✅ Расчет поступлений по периодам
- ✅ Расчет выбытий по периодам
- ✅ Расчет чистого денежного потока
- ✅ Группировка по статьям доходов
- ✅ Группировка по статьям расходов
- ✅ Общие итоги за период

**Реализованные графики:**
- ✅ Линейный график движения денежных средств (поступления, выбытия, чистый поток)
- ✅ Круговая диаграмма поступлений по статьям
- ✅ Круговая диаграмма расходов по статьям
- ✅ Таблица с детализацией по периодам

**Особенности:**
- Фильтрация по датам
- Выбор группировки (месяц/квартал/год)
- Визуальный контроль: синий график (поступления) должен быть выше красного (выбытия)

### 7. ОПУ - Отчет о прибылях и убытках
**Реализованные расчеты:**
- ✅ Выручка из реализации
- ✅ Себестоимость проданных товаров (из отгрузок)
- ✅ Валовая прибыль (выручка - себестоимость)
- ✅ Рентабельность валовой прибыли (%)
- ✅ Коммерческие расходы (из ВВОД 1)
- ✅ Управленческие расходы
- ✅ Операционная прибыль
- ✅ Прочие доходы и расходы
- ✅ Прибыль до налогообложения
- ✅ Налоги
- ✅ Чистая прибыль
- ✅ Рентабельность чистой прибыли (%)

**Отображение:**
- Структурированная таблица с расчетами
- Выделение ключевых показателей

### 8. РЕАЛИЗАЦИЯ
- ✅ Ввод данных о реализации с маркетплейсов
- ✅ Поддержка разных маркетплейсов (Ozon, Wildberries, Яндекс.Маркет)
- ✅ Учет выручки и количества
- ✅ Фильтрация по датам и маркетплейсам
- ✅ CRUD операции
- ✅ Импорт/экспорт Excel/CSV

### 9. ОТГРУЗКА
- ✅ Ввод данных об отгрузке товаров
- ✅ Привязка к товарам
- ✅ Учет сырьевой себестоимости
- ✅ Количество и стоимость
- ✅ Фильтрация по датам и маркетплейсам
- ✅ CRUD операции

### 10. ТОВАРЫ
- ✅ Управление товарами (CRUD)
- ✅ Артикулы (SKU) с проверкой уникальности
- ✅ Себестоимость и цена продажи
- ✅ Автоматический расчет маржи
- ✅ Активация/деактивация товаров
- ✅ Импорт/экспорт Excel/CSV

### 11. Панель приборов (Dashboard)
**Реализованные расчеты:**
- ✅ Динамика остатков на счетах (по месяцам)
- ✅ Динамика чистой прибыли (по месяцам)
- ✅ Динамика рентабельности чистой прибыли (по месяцам)
- ✅ Динамика валовой прибыли (по месяцам)
- ✅ Динамика рентабельности валовой прибыли (по месяцам)
- ✅ Текущие показатели за период:
  - Выручка
  - Себестоимость
  - Расходы
  - Валовая прибыль и рентабельность
  - Чистая прибыль и рентабельность

**Реализованные графики:**
- ✅ График динамики остатков на счетах (линейный)
- ✅ График динамики чистой прибыли (столбчатый)
- ✅ График динамики рентабельности чистой прибыли (линейный)
- ✅ График валовой прибыли и рентабельности (два Y-оси)

**Особенности:**
- Настраиваемый период (по умолчанию последние 3 месяца)
- Автоматическое обновление при изменении данных
- Визуализация ключевых метрик

### 12. Импорт/Экспорт данных
**Экспорт:**
- ✅ Экспорт движения денег в Excel/CSV
- ✅ Экспорт реализации в Excel/CSV
- ✅ Экспорт товаров в Excel/CSV
- ✅ Форматирование данных для удобства

**Импорт:**
- ✅ Импорт движения денег из Excel/CSV
- ✅ Импорт товаров из Excel/CSV
- ✅ Валидация данных при импорте
- ✅ Обработка ошибок с детальными сообщениями
- ✅ Автоматическое сопоставление со справочниками

## Модули системы

1. **Авторизация** — JWT, регистрация/вход
2. **Справочники** — CRUD для статей доходов/расходов
3. **ВВОД 1** — движение денег (таблица с валидацией)
4. **ВВОД 2** — активы и обязательства
5. **БАЛАНС** — автоматический расчет и отображение
6. **ОДДС** — отчет с графиками (динамика поступлений/списаний)
7. **ОПУ** — отчет о прибылях и убытках
8. **РЕАЛИЗАЦИЯ** — ввод данных о реализации с маркетплейсов
9. **ОТГРУЗКА** — ввод данных об отгрузке
10. **ТОВАРЫ** — управление товарами
11. **Панель приборов** — дашборд с графиками и KPI
12. **Импорт/Экспорт** — Excel/CSV

## Дизайн

- Стиль 1С Предприятие 8.5 (минимализм, серые тона, синие акценты)
- Адаптивный интерфейс (работает на мобильных устройствах)
- Четкие таблицы с границами
- Стандартные формы ввода
- Прямоугольные кнопки без скруглений

## API Документация

После запуска backend, документация API доступна по адресу:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Структура проекта

```
fin_a/
├── backend/              # FastAPI приложение
│   ├── app/
│   │   ├── api/         # API endpoints
│   │   ├── models/      # SQLAlchemy модели
│   │   ├── schemas/     # Pydantic схемы
│   │   ├── services/    # Бизнес-логика
│   │   ├── auth/        # Авторизация (JWT)
│   │   └── database.py  # Настройка БД
│   ├── requirements.txt
│   └── main.py
│
├── frontend/             # React приложение
│   ├── src/
│   │   ├── components/  # React компоненты
│   │   ├── pages/       # Страницы (модули)
│   │   ├── services/    # API клиенты
│   │   ├── store/       # State management
│   │   └── styles/      # Стили в стиле 1С
│   ├── package.json
│   └── ...
│
└── README.md
```

## Особенности реализации

### Расчеты
- Все расчеты выполняются автоматически на основе введенных данных
- Поддержка фильтрации по датам
- Группировка данных по периодам (месяц/квартал/год)
- Расчет рентабельности с защитой от деления на ноль

### Графики
- Использование библиотеки Recharts для визуализации
- Адаптивные графики (подстраиваются под размер экрана)
- Интерактивные подсказки при наведении
- Легенды и подписи осей
- Цветовое кодирование (зеленый - доходы, красный - расходы, синий - итоги)

### Валидация
- Проверка обязательных полей на frontend и backend
- Валидация типов данных
- Проверка уникальности (SKU товаров, email пользователей)
- Обработка ошибок с понятными сообщениями

### Производительность
- Оптимизированные SQL запросы с использованием агрегатных функций
- Пагинация для больших списков
- Кэширование справочников на frontend

## Дальнейшее развитие

Возможные улучшения:
- Интеграция с маркетплейсами (Ozon, Wildberries) для автоматического получения данных
- Расширенная аналитика и прогнозирование
- Многопользовательский режим с ролями
- Уведомления и напоминания
- Мобильное приложение
- Расширенная система категоризации расходов

## Лицензия

Проект создан для внутреннего использования.
